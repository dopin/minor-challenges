# Array#flatten vs Array#concat

下記ツイートを拝見して、ヘ〜と思ったので検証(ベンチマーク)してみた。

https://mobile.twitter.com/fuu_tech/status/1275774701386600450

>Rubyで二次元のジャグ配列[[], [], ...]をflattenメソッドで均すより、

```ruby
result = []
jagged_arr.each do |arr|
  result.concat(result)
end
```

> とconcatしていった方が確実に早いことが分かった

早いと書かれているので、速度が速いという意味かどうかは不明だけど、おそらく速度のことだろうということで。

## 結果

- `Array#flatten(1)`が最速(?)
- そもそもconcatはどう実装してるのか、実装の意図がよく分かってなかった😅
  - 同じ結果を得ることを保証するようテストを書いたけど、concatだと多次元配列のままで、どう実装したんだろう？🤔 flattenせずに、多次元配列のまま操作した方が速い(話が**早い**)と言う意味だったのかな

以下ベンチマーク結果

```
       user     system      total        real
concat:         0.055423   0.005947   0.061370 (  0.061873)
shift:          0.117135   0.009050   0.126185 (  0.126617)
flatten:        0.098514   0.001987   0.100501 (  0.101687)
flatten(lv=1):  0.057601   0.000055   0.057656 (  0.058260)
```

### オチ？

https://mobile.twitter.com/fuu_tech/status/1275776068251643904

> flattenに引数付けて1を与えると同じくらいの速度だった。つまりflattenの引数を付けないと無駄に時間がかかるから、あらかじめ深さが分かってる場合は引数で指定するべきだね

この方よく調べていらっしゃる。タスク丸投げしたい。

## 実行方法

`Makefile`を覗くなりして、試行錯誤してくだしあ。
